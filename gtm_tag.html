<!DOCTYPE html>
<html>
<head>
  <title>GTM tag</title>

  <script>
    document.onload(function() {
      history.pushState({}, "test", "https://cmihail.github.io/gtm_tag.html");
      const originalPushState = history.pushState;
      history.pushState = function(context, title, url) {
        console.log("History capture before GTM. ", title, url);
        originalPushState(context, title, url);
      }
    })

    // Google Tag Manager
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M25HTBK');
    // End Google Tag Manager
  </script>
</head>

<body>
  <h2>GTM tag</h2>

  <form onsubmit="return false;">
    <label for="fname">First name:</label><br>
    <input type="text" id="fname" name="fname"><br>
    <label for="lname">Last name:</label><br>
    <input type="text" id="lname" name="lname"><br>
    <label for="email">Email</label><br>
    <input type="email" id="email" name="email"><br>
    <input type="submit" value="Submit">
  </form>

  <script>
    // Testing cookies from https://www.abfunds.com.hk/hk/zh-hk/investor/home.html
    document.cookie = "AMCV_B66802BE533094020A490D4C%40AdobeOrg=" +
      "77933605%7CMCIDTS%7C18926%7CMCMID%7C60899328857646758771130318089618037441%7C" +
      "MCAAMLH-1635778521%7C6%7CMCAAMB-1635778521%7C" +
      "RKhpRz8krg2tLO6pguXWp5olkAcUniQYPHaMWWgdJ3xzPWQmdj0y%7C" +
      "MCOPTOUT-1635180921s%7CNONE%7CvVersion%7C4.5.1";
    document.cookie = "AMCVS_B66802BE533094020A490D4C%40AdobeOrg=1";

    setTimeout(function() {
      const modifiedPushState = history.pushState;
      history.pushState = function(context, title, url) {
        console.log("History capture after GTM. ", title, url);
        modifiedPushState(context, title, url);
      }

      window.ldfdr.pageview({
        pageUrl: "https://cmihail.github.io/page_view_test",
        pageTitle: "Page view test"
      });
    }, 1000);
  </script>

  <iframe width="420" height="315"
                      src="https://www.youtube-nocookie.com/embed/eX-3Yc8vARs?enablejsapi=1">
  </iframe>

  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M25HTBK"
            height="0" width="0" style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->
</body>
</html>
